<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NP - Safety Awareness Training</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --gold: #c5a028;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light);
            color: var(--primary);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-section { text-align: center; margin-bottom: 25px; }
        .company-logo { max-width: 160px; height: auto; margin-bottom: 2px; display: inline-block; }
        .company-name { font-size: 26px; font-weight: bold; color: #333; margin: 0 0 10px 0; }
        .training-title { font-size: 20px; font-weight: 600; color: #333; margin: 10px 0; }
        .blue-line { border: none; border-top: 2px solid var(--accent); margin: 0; }
        .hidden { display: none; }

        /* Form Styles */
        .info-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; text-align: left; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 5px; font-size: 0.9em; }
        .form-group input, .form-group select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .full-width { grid-column: span 2; }

        .btn {
            display: inline-block;
            background: var(--accent);
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
            margin: 10px 5px;
            text-decoration: none;
        }

        .btn:hover:not(:disabled) { background: #2980b9; transform: translateY(-2px); }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; opacity: 0.7; }
        .btn-gold { background: var(--gold); }

        .briefing-box {
            background: #f8f9fa;
            padding: 15px;
            border-left: 5px solid var(--accent);
            margin: 20px 0;
        }

        .pdf-container {
            width: 100%;
            height: 600px;
            border: 2px solid #eee;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        iframe { width: 100%; height: 100%; border: none; }

        .timer-box { font-size: 1.2rem; font-weight: bold; color: var(--danger); text-align: right; margin-bottom: 10px; }
        .question-card { padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff; min-height: 300px; }
        .options label { display: block; margin: 12px 0; cursor: pointer; padding: 15px; background: #f9f9f9; border: 1px solid #eee; border-radius: 6px; transition: 0.2s; }
        .options label:hover { background: #eef7ff; }

        .progress-bar-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin: 20px 0; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .results-box { text-align: center; padding: 20px; }
        .pass { color: var(--success); font-weight: bold; font-size: 1.5em; }
        .fail { color: var(--danger); font-weight: bold; font-size: 1.5em; }

        /* CERTIFICATE STYLES WITH UPDATED FADED WATERMARK */
        #certificate-template {
            width: 850px;
            height: 600px;
            padding: 40px;
            text-align: center;
            border: 15px double var(--secondary);
            background: #fff;
            margin: 20px auto;
            position: relative;
            color: #333;
            box-sizing: border-box;
            overflow: hidden;
        }

        .watermark-overlay {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            font-size: 22px; /* Smaller font */
            font-weight: bold;
            color: rgba(180, 180, 180, 0.15); /* Much more faded transparency */
            transform: rotate(-35deg);
            z-index: 0;
            pointer-events: none;
            line-height: 100px; /* Tighter line spacing for smaller font */
            letter-spacing: 6px;
            white-space: pre;
        }

        .cert-inner {
            position: relative;
            z-index: 1;
            border: 2px solid var(--gold);
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: transparent;
        }

        .cert-header { font-size: 38px; font-weight: bold; color: var(--secondary); letter-spacing: 2px; }
        .cert-name { font-size: 45px; font-family: 'Georgia', serif; font-style: italic; border-bottom: 2px solid #333; display: inline-block; min-width: 400px; margin: 20px 0; color: #000; }
        .cert-footer { margin-top: 40px; width: 100%; display: flex; justify-content: space-around; align-items: flex-end; }
        .sig-box { border-top: 1px solid #333; width: 200px; font-size: 14px; padding-top: 5px; }

        @media print {
            body { background: none; padding: 0; margin: 0; }
            .container { display: none !important; }
            #certificate-template {
                display: block !important;
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                border: 10px double #333;
            }
        }
    </style>
</head>
<body>

<div class="container" id="main-app">
    <div id="briefing-section">
        <div class="header-section">
            <img src="NEOPETRO LOGO.png" alt="NEOPETRO Logo" class="company-logo">
            <div class="company-name">NEOPETRO SDN BHD</div>
            <div class="training-title">Safety Awareness Training</div>
            <hr class="blue-line">
        </div>
        <p>Welcome to the <strong>NEOPETRO</strong> mandatory safety briefing. Review all materials before the timed assessment.</p>
        <div class="briefing-box">
            <h3>System Instructions:</h3>
            <ul>
                <li>Complete your personal information accurately.</li>
                <li>Exam is timed: <strong>1 minute per question</strong>.</li>
                <li>Passing Mark: <strong>80% (20/25)</strong>.</li>
                <li>Qualified personnel will receive a downloadable Certificate.</li>
            </ul>
        </div>
        <div style="text-align: center;"><button class="btn" onclick="showCrewInfo()">Next</button></div>
    </div>

    <div id="crew-info-section" class="hidden">
        <div class="header-section">
            <div class="company-name">Crew Information</div>
            <hr class="blue-line">
        </div>
        <form id="crewForm" class="info-form">
            <div class="form-group full-width">
                <label>Full Name</label>
                <input type="text" id="crew_name" required placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label>Position</label>
                <select id="crew_position" required>
                    <option value="">-- Select Position --</option>
                    <option>Master</option><option>Chief Officer</option><option>Second Officer</option>
                    <option>Chief Engineer</option><option>Second Engineer</option><option>Greaser</option>
                    <option>Able Body</option><option>Bosun</option><option>Cook</option>
                </select>
            </div>
            <div class="form-group">
                <label>Training Date</label>
                <input type="text" id="current_date" readonly style="background:#f0f0f0;">
            </div>
            <div class="form-group">
                <label>Vessel Sign On</label>
                <select id="vessel_name" required>
                    <option value="">-- Select Vessel --</option>
                    <option>Neopetro 8</option><option>Neopetro 10</option>
                    <option>Neopetro 11</option><option>Neopetro 12</option>
                    <option>Neopetro 18</option><option>NP Explorer</option>
                </select>
            </div>
            <div class="form-group">
                <label>Sign On Date</label>
                <input type="date" id="sign_on_date" required>
            </div>
        </form>
        <div style="text-align: center;">
            <button class="btn" style="background:#95a5a6" onclick="location.reload()">Back</button>
            <button class="btn" onclick="validateAndProceed()">Proceed to Category</button>
        </div>
    </div>

    <div id="category-selection" class="hidden">
        <div class="header-section"><div class="company-name">Select Training Type</div><hr class="blue-line"></div>
        <div class="selection-grid" style="display: flex; justify-content: center; gap: 10px;">
            <button class="btn" onclick="openPDF('SAT-A2')">Safety Awareness Training (SAT A)</button>
            <button class="btn" onclick="showSubSelection('SAT B')">Safety Awareness Training (SAT B)</button>
        </div>
    </div>

    <div id="sub-selection" class="hidden">
        <div class="header-section"><div class="company-name" id="selected-main-category">Category</div><hr class="blue-line"></div>
        <div id="sub-grid" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;"></div>
        <div style="text-align: center; margin-top: 20px;"><button class="btn" style="background:#95a5a6" onclick="showCategorySelection()">Back</button></div>
    </div>

    <div id="pdf-viewer" class="hidden">
        <div class="header-section"><div class="company-name" id="current-course-title">Training Materials</div><hr class="blue-line"></div>
        <div class="pdf-container" id="pdf-box"></div>
        <div style="text-align: center;">
            <label style="cursor: pointer; font-weight: bold;">
                <input type="checkbox" id="read-confirm" onclick="toggleExamBtn()"> I have completed reading the material.
            </label><br>
            <button class="btn" id="exam-start-btn" disabled onclick="startExam()">Start Assessment</button>
        </div>
    </div>

    <div id="exam-section" class="hidden">
        <div class="header-section"><div class="company-name">Assessment</div><hr class="blue-line"></div>
        <div class="progress-bar-container"><div class="progress-bar-fill" id="exam-progress"></div></div>
        <div class="timer-box">Time Remaining: <span id="timer-count">60</span>s</div>
        <div id="question-area"></div>
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn" id="next-q-btn" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <div id="result-section" class="hidden">
        <div class="header-section">
            <img src="NEOPETRO LOGO.png" alt="NEOPETRO Logo" class="company-logo">
            <div class="company-name">Exam Results</div>
            <hr class="blue-line">
        </div>
        <div id="result-content" class="results-box"></div>
        <div id="result-actions" style="text-align: center; margin-top: 20px;"></div>
    </div>
</div>

<div id="certificate-template" class="hidden">
    <div class="watermark-overlay">
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
    </div>
    <div class="cert-inner">
        <img src="NEOPETRO LOGO.png" style="width: 120px; margin-bottom: 10px;">
        <div class="cert-header">CERTIFICATE OF COMPETENCY</div>
        <p>This is to certify that</p>
        <div class="cert-name" id="cert-user-name">MARINER NAME</div>
        <p>has successfully completed the assessment for</p>
        <div style="font-size: 24px; font-weight: bold; color: var(--accent);" id="cert-course-name">MODULE NAME</div>
        <p>conducted on <span id="cert-date">--/--/----</span></p>
        <p><strong>Final Score: <span id="cert-score">0</span>%</strong></p>
        <div class="cert-footer">
            <div class="sig-box">HSSE Department<br>NEOPETRO Authorized</div>
            <div class="sig-box"><br>Company Stamp</div>
        </div>
    </div>
</div>

<script>
    const trainingData = { 'SAT A': ['SAT-A2'], 'SAT B': ['SAT-B1', 'SAT-B2'] };
    const pdfFiles = { 'SAT-A2': 'SAT A2.pdf', 'SAT-B1': 'SAT B1.pdf', 'SAT-B2': 'SAT B2.pdf' };
    
    const masterQuestionBank = [
        { q: "Who has the right to Stop Work?", a: ["Master", "Contractor/Supplier", "DPA", "All of the above"], correct: "All of the above" },
        { q: "What is the system called for energy isolation process?", a: ["MOPO", "TOTO", "LOTO", "PTW"], correct: "LOTO" },
        { q: "What is the Company's prescribed Limit for Blood Alcohol Concentration (BAC)?", a: ["0.00%", "0.01%", "0.02%", "0.03%"], correct: "0.00%" },
        { q: "Who is responsible for your safety?", a: ["Managing Director", "General Manager", "DPA", "Myself"], correct: "Myself" },
        { q: "How many rules does the IOGP Life-saving rules have?", a: ["9", "12", "15", "18"], correct: "9" },
        { q: "What document required to report an unsafe act and unsafe condition?", a: ["Statement of Fact", "Initial Incident Notification Form", "ACT Form", "Incident Investigation Report"], correct: "ACT Form" },
        { q: "Which physical property of H2S is wrong?", a: ["Toxic gas", "Flammable", "Rotten egg smell at high concentration", "Heavier than air"], correct: "Rotten egg smell at high concentration" },
        { q: "Where is the MUSTER STATION located?", a: ["Inside Bridegroom", "Main Deck on vessel", "Engine Room", "Galley"], correct: "Main Deck on vessel" },
        { q: "What is the frequency of Safety Meeting to be carry out onboard?", a: ["Weekly", "Quarterly", "Monthly", "Yearly"], correct: "Monthly" },
        { q: "Who has the overall responsibility for HSSE in the Company?", a: ["Myself", "DPA", "General Manager", "Managing Director"], correct: "Managing Director" },
        { q: "What is legislation related to Marine Pollution?", a: ["SOLAS", "STWC", "MARPOL", "MLC"], correct: "MARPOL" },
        { q: "When should the Shipboard Safety Officer conducting familiarization briefing to new on-signer onboard?", a: ["Immediately", "Within 1 week", "Within 1 hour", "Within 24 hours"], correct: "Immediately" },
        { q: "Choose the correct answer. The most effective hierarchy of control to the least effective.", a: ["Elimination -> Substitution -> Engineering Controls -> Administrative Controls -> PPE", "Engineering Controls -> PPE -> Administrative Controls -> Substitution -> Elimination", "PPE -> Administrative Controls -> Engineering Controls -> Substitution -> Elimination", "Elimination -> PPE -> Administrative Controls -> Engineering Controls -> Substitution"], correct: "Elimination -> Substitution -> Engineering Controls -> Administrative Controls -> PPE" },
        { q: "Any Near Miss/Incident/ Accident must be reported to DPA within?", a: ["1 hour", "2 hours", "3 hours", "24 hours or immediately if practicable."], correct: "24 hours or immediately if practicable." },
        { q: "What is the first action to be taken if an unwanted event occurred onboard?", a: ["Abandon ship", "Inform/call Master", "Inform DPA", "Run"], correct: "Inform/call Master" },
        { q: "What is NOT part of effective watch keeping duties?", a: ["Proper handing over of watch", "Watching video in mobile devices", "Call master when in doubt", "Sufficient lookout"], correct: "Watching video in mobile devices" },
        { q: "Which policy states the
