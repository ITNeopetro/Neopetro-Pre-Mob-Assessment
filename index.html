<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NP - Safety Awareness Training</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --gold: #c5a028;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--light);
            color: var(--primary);
            margin: 0;
            padding: 20px;
            position: relative;
            min-height: 100vh;
        }

        /* Background Image with 10% Opacity */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('Screenshot 2024-04-19 075811.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.10; 
            z-index: -1; 
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .header-section { text-align: center; margin-bottom: 25px; }
        .company-logo { max-width: 160px; height: auto; margin-bottom: 2px; display: inline-block; }
        .company-name { font-size: 26px; font-weight: bold; color: #333; margin: 0 0 10px 0; }
        .training-title { font-size: 20px; font-weight: 600; color: #333; margin: 10px 0; }
        .blue-line { border: none; border-top: 2px solid var(--accent); margin: 0; }
        .hidden { display: none; }

        .info-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; text-align: left; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 5px; font-size: 0.9em; }
        .form-group input, .form-group select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .full-width { grid-column: span 2; }

        .btn {
            display: inline-block;
            background: var(--accent);
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
            margin: 10px 5px;
            text-decoration: none;
        }

        .btn:hover:not(:disabled) { background: #2980b9; transform: translateY(-2px); }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; opacity: 0.7; }
        .btn-gold { background: var(--gold); }

        .briefing-box {
            background: #f8f9fa;
            padding: 15px;
            border-left: 5px solid var(--accent);
            margin: 20px 0;
        }

        .pdf-container {
            width: 100%;
            height: 600px;
            border: 2px solid #eee;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        iframe { width: 100%; height: 100%; border: none; }

        .timer-box { font-size: 1.2rem; font-weight: bold; color: var(--danger); text-align: right; margin-bottom: 10px; }
        .question-card { padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff; min-height: 300px; }
        .options label { display: block; margin: 12px 0; cursor: pointer; padding: 15px; background: #f9f9f9; border: 1px solid #eee; border-radius: 6px; transition: 0.2s; }
        .options label:hover { background: #eef7ff; }

        .progress-bar-container { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin: 20px 0; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

        .results-box { text-align: center; padding: 20px; }
        .pass { color: var(--success); font-weight: bold; font-size: 1.5em; }
        .fail { color: var(--danger); font-weight: bold; font-size: 1.5em; }

        #certificate-template {
            width: 850px;
            height: 600px;
            padding: 40px;
            text-align: center;
            border: 15px double var(--secondary);
            background: #fff;
            margin: 20px auto;
            position: relative;
            color: #333;
            box-sizing: border-box;
            overflow: hidden;
        }

        .watermark-overlay {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            font-size: 22px; 
            font-weight: bold;
            color: rgba(180, 180, 180, 0.12);
            transform: rotate(-35deg);
            z-index: 0;
            pointer-events: none;
            line-height: 100px; 
            letter-spacing: 5px;
            white-space: pre;
        }

        .cert-inner {
            position: relative;
            z-index: 1;
            border: 2px solid var(--gold);
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: transparent;
        }

        .cert-header { font-size: 38px; font-weight: bold; color: var(--secondary); letter-spacing: 2px; }
        .cert-name { font-size: 45px; font-family: 'Georgia', serif; font-style: italic; border-bottom: 2px solid #333; display: inline-block; min-width: 400px; margin: 20px 0; color: #000; }
        .cert-footer { margin-top: 40px; width: 100%; display: flex; justify-content: space-around; align-items: flex-end; }
        .sig-box { border-top: 1px solid #333; width: 200px; font-size: 14px; padding-top: 5px; }

        @media print {
            body::before { display: none; }
            body { background: none; padding: 0; margin: 0; }
            .container { display: none !important; }
            #certificate-template {
                display: block !important;
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                border: 10px double #333;
            }
        }
    </style>
</head>
<body>

<div class="container" id="main-app">
    <div id="briefing-section">
        <div class="header-section">
            <img src="NEOPETRO LOGO.png" alt="NEOPETRO Logo" class="company-logo">
            <div class="company-name">NEOPETRO SDN BHD</div>
            <div class="training-title">Safety Awareness Training</div>
            <hr class="blue-line">
        </div>
        <p>Welcome to the <strong>NEOPETRO</strong> mandatory safety briefing. Review all materials before the timed assessment.</p>
        <div class="briefing-box">
            <h3>System Instructions:</h3>
            <ul>
                <li>Complete your personal information accurately.</li>
                <li>Exam is timed: <strong>1 minute per question</strong>.</li>
                <li>Passing Mark: <strong>80% (20/25)</strong>.</li>
                <li>Qualified personnel will receive a downloadable Certificate.</li>
            </ul>
        </div>
        <div style="text-align: center;"><button class="btn" onclick="showCrewInfo()">Next</button></div>
    </div>

    <div id="crew-info-section" class="hidden">
        <div class="header-section">
            <div class="company-name">Crew Information</div>
            <hr class="blue-line">
        </div>
        <form id="crewForm" class="info-form">
            <div class="form-group full-width">
                <label>Full Name</label>
                <input type="text" id="crew_name" required placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label>Position</label>
                <select id="crew_position" required>
                    <option value="">-- Select Position --</option>
                    <option>Master</option><option>Chief Officer</option><option>Second Officer</option>
                    <option>Chief Engineer</option><option>Second Engineer</option><option>Greaser</option>
                    <option>Able Body</option><option>Bosun</option><option>Cook</option>
                </select>
            </div>
            <div class="form-group">
                <label>Training Date</label>
                <input type="text" id="current_date" readonly style="background:#f0f0f0;">
            </div>
            <div class="form-group">
                <label>Vessel Sign On</label>
                <select id="vessel_name" required>
                    <option value="">-- Select Vessel --</option>
                    <option>Neopetro 8</option><option>Neopetro 10</option>
                    <option>Neopetro 11</option><option>Neopetro 12</option>
                    <option>Neopetro 18</option><option>NP Explorer</option>
                </select>
            </div>
            <div class="form-group">
                <label>Sign On Date</label>
                <input type="date" id="sign_on_date" required>
            </div>
        </form>
        <div style="text-align: center;">
            <button class="btn" style="background:#95a5a6" onclick="location.reload()">Back</button>
            <button class="btn" onclick="validateAndProceed()">Proceed to Category</button>
        </div>
    </div>

    <div id="category-selection" class="hidden">
        <div class="header-section"><div class="company-name">Select Training Type</div><hr class="blue-line"></div>
        <div class="selection-grid" style="display: flex; justify-content: center; gap: 10px;">
            <button class="btn" onclick="openPDF('SAT-A2')">Safety Awareness Training (SAT A)</button>
            <button class="btn" onclick="alert('Coming Soon')">Safety Awareness Training (SAT B)</button>
        </div>
    </div>

    <div id="sub-selection" class="hidden">
        <div class="header-section"><div class="company-name" id="selected-main-category">Category</div><hr class="blue-line"></div>
        <div id="sub-grid" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;"></div>
        <div style="text-align: center; margin-top: 20px;"><button class="btn" style="background:#95a5a6" onclick="showCategorySelection()">Back</button></div>
    </div>

    <div id="pdf-viewer" class="hidden">
        <div class="header-section"><div class="company-name" id="current-course-title">Training Materials</div><hr class="blue-line"></div>
        <div class="pdf-container" id="pdf-box"></div>
        <div style="text-align: center;">
            <label style="cursor: pointer; font-weight: bold;">
                <input type="checkbox" id="read-confirm" onclick="toggleExamBtn()"> I have completed reading the material.
            </label><br>
            <button class="btn" id="exam-start-btn" disabled onclick="startExam()">Start Assessment</button>
        </div>
    </div>

    <div id="exam-section" class="hidden">
        <div class="header-section"><div class="company-name">Assessment</div><hr class="blue-line"></div>
        <div class="progress-bar-container"><div class="progress-bar-fill" id="exam-progress"></div></div>
        <div class="timer-box">Time Remaining: <span id="timer-count">60</span>s</div>
        <div id="question-area"></div>
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn" id="next-q-btn" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <div id="result-section" class="hidden">
        <div class="header-section">
            <img src="NEOPETRO LOGO.png" alt="NEOPETRO Logo" class="company-logo">
            <div class="company-name">Exam Results</div>
            <hr class="blue-line">
        </div>
        <div id="result-content" class="results-box"></div>
        <div id="result-actions" style="text-align: center; margin-top: 20px;"></div>
    </div>
</div>

<div id="certificate-template" class="hidden">
    <div class="watermark-overlay">
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO NEOPETRO
    </div>
    <div class="cert-inner">
        <img src="NEOPETRO LOGO.png" style="width: 120px; margin-bottom: 10px;">
        <div class="cert-header">CERTIFICATE OF COMPETENCY</div>
        <p>This is to certify that</p>
        <div class="cert-name" id="cert-user-name">MARINER NAME</div>
        <p>has successfully completed the assessment for</p>
        <div style="font-size: 24px; font-weight: bold; color: var(--accent);" id="cert-course-name">MODULE NAME</div>
        <p>conducted on <span id="cert-date">--/--/----</span></p>
        <p><strong>Final Score: <span id="cert-score">0</span>%</strong></p>
        <div class="cert-footer">
            <div class="sig-box">HSSE Department<br>NEOPETRO Authorized</div>
            <div class="sig-box"><br>Company Stamp</div>
        </div>
    </div>
</div>

<script>
    const trainingData = { 'SAT A': ['SAT-A2'], 'SAT B': ['SAT-B1', 'SAT-B2'] };
    const pdfFiles = { 'SAT-A2': 'SAT A2.pdf', 'SAT-B1': 'SAT B1.pdf', 'SAT-B2': 'SAT B2.pdf' };
    
    const masterQuestionBank = [
        { q: "What is HSSE?", a: ["Heat, Safe, Security, Environment", "Health, Safety, Security, Environment", "Help Safety Security Environment", "Heal, Safe, Secure, Environment"], correct: "Health, Safety, Security, Environment" },
        { q: "Which of the following is NOT the Company's core values?", a: ["Corruption", "Respect", "Excellence", "Integrity"], correct: "Corruption" },
        { q: "What is legislation related to Marine Pollution?", a: ["SOLAS", "STWC", "MARPOL", "MLC"], correct: "MARPOL" },
        { q: "What is the alcohol tolerance level allowed in Maritime industry?", a: ["0.01%", "0.00%", "0.04%", "0.02%"], correct: "0.00%" },
        { q: "Which is incorrect statement about MLC legislation?", a: ["Any person above 15 years old is allowed to work in maritime industry.", "MLC stands for Maritime Labour Convention", "Every seafarer has the right to a safe and secure workplace", "None of the above"], correct: "Any person above 15 years old is allowed to work in maritime industry." },
        { q: "In accordance to MLC legislation, which MINIMUM hours of rest for seafarers below is correct?", a: ["14 hours in any 24-hour period", "15 hours in any 24-hour period", "10 hours in any 24-hour period", "12 hours in any 24-hour period"], correct: "10 hours in any 24-hour period" },
        { q: "Which is incorrect about introduction to HSSE?", a: ["The Company's commitment towards safety & welfare", "Harm to People, Environment, Assets and Reputation", "Ensuring Safe practices in ships operations", "Establishing safeguard against all identified risks"], correct: "Harm to People, Environment, Assets and Reputation" },
        { q: "HSSE expectation includes:", a: ["Adhered to HSSE Compliances", "Not wearing PPE", "Carry out sounding with improper tools", "Incomplete checklist before work"], correct: "Adhered to HSSE Compliances" },
        { q: "Who is responsible for your safety?", a: ["Managing Director", "General Manager", "DPA", "Myself"], correct: "Myself" },
        { q: "Who has the overall responsibility for HSSE in the Company?", a: ["Myself", "DPA", "General Manager", "Managing Director"], correct: "Managing Director" },
        { q: "What is the frequency of Safety Meeting to be carry out onboard?", a: ["Weekly", "Quarterly", "Monthly", "Yearly"], correct: "Monthly" },
        { q: "What is the best approach when conducting an intervention?", a: ["Observe, Approach, Discuss, Report, Review", "Approach, Discuss, Report, Review, Observed", "Review, Report, Discuss, Approach, Observed", "Report, Observe, Approach, Discuss, Review"], correct: "Observe, Approach, Discuss, Report, Review" },
        { q: "Who has the right to Stop Work?", a: ["DPA", "Contractor/Supplier", "Master", "Able Body", "All of the above"], correct: "All of the above" },
        { q: "Why UDAT to be carried out?", a: ["To identify drug addict", "To terminate employee", "To ensure workplace free from serious threats", "None of the above"], correct: "To ensure workplace free from serious threats" },
        { q: "Which is true regarding smoking onboard?", a: ["Allowed in 500m zone", "Not allowed at all", "Only allowed at designated area", "Allowed in cabin/washrooms"], correct: "Only allowed at designated area" },
        { q: "Who should maintain garbage record book onboard?", a: ["Master", "Chief Officer", "Chief Engineer", "2nd Engineer"], correct: "Chief Officer" },
        { q: "Who is responsible for Safety and Health Programme onboard?", a: ["Master", "Chief Officer", "Chief Engineer", "2nd Engineer"], correct: "Chief Officer" },
        { q: "What is required in the Cyber Security Policy?", a: ["Protect confidential data", "Keep email safe", "Managing device passwords", "Transferring data securely", "All of the above"], correct: "All of the above" },
        { q: "Who is responsible for Hours of Work / Rest record?", a: ["Master", "Chief Officer", "DPA", "Seafarers"], correct: "Seafarers" },
        { q: "What is the first action to be taken if an unwanted event occurred onboard?", a: ["Abandon ship", "Inform/call Master", "Inform DPA", "Run"], correct: "Inform/call Master" },
        { q: "What document required to report an unsafe act and unsafe condition?", a: ["Statement of Fact", "Initial Incident Notification Form", "ACT Form", "Incident Investigation Report"], correct: "ACT Form" },
        { q: "When should the Shipboard Safety Officer conduct familiarization briefing to new on-signer?", a: ["Immediately", "Within 1 week", "Within 1 hour", "Within 24 hours"], correct: "Immediately" },
        { q: "What is NOT part of effective watch keeping duties?", a: ["Proper handing over of watch", "Watching video in mobile devices", "Call master when in doubt", "Sufficient lookout"], correct: "Watching video in mobile devices" },
        { q: "Operations Manager has control and interfere with offshore operations maneuvering?", a: ["True", "False"], correct: "False" },
        { q: "Management Facility Visit is part of the Company's HSSE commitment?", a: ["False", "True"], correct: "True" },
        { q: "What documents are required for PTW Application onboard?", a: ["PTW Form, Training Certificate", "PTW Form, Checklist, JHA", "PTW Form, JHA, Checklist, Toolbox Talk Record", "None"], correct: "PTW Form, JHA, Checklist, Toolbox Talk Record" },
        { q: "Who is the responsible officer in charge for bunkering activity?", a: ["Master", "CSR", "Chief Officer", "Chief Engineer"], correct: "Chief Engineer" },
        { q: "ISM Code requires Document of Compliance to be audited on what basis?", a: ["Annually", "2 yearly", "5 yearly", "6 monthly"], correct: "Annually" },
        { q: "Safety Management Certificate (SMC) is endorsement for?", a: ["Office", "Vessel"], correct: "Vessel" },
        { q: "Any concerns pertaining Handover Checklist Form must be highlighted within?", a: ["1 day", "3 days", "5 days", "7 days"], correct: "7 days" },
        { q: "The Company operates in which locations?", a: ["Labuan", "Kota Kinabalu", "Miri", "All of the above"], correct: "All of the above" },
        { q: "Open toe footwear is allowed onboard vessel?", a: ["True", "False"], correct: "False" },
        { q: "What is the system called for energy isolation process?", a: ["MOPO", "TOTO", "LOTO", "PTW"], correct: "LOTO" },
        { q: "Which Emergency Alarm below is correct?", a: ["Boat Mustering = 7 short + 1 long", "Fire = Continuous Ringing", "MOB = 3 Long Blasts", "All the above are correct"], correct: "All the above are correct" },
        { q: "What document reflects the duties of ERT onboard?", a: ["Familiarization Checklist", "MOC", "TBT List", "Muster List"], correct: "Muster List" },
        { q: "Health monitoring onboard must be carried out and submitted on what basis?", a: ["Weekly/monthly", "Monthly/quarterly", "Daily/weekly", "Daily/monthly"], correct: "Weekly/monthly" },
        { q: "Where are the Emergency Contact Numbers posted?", a: ["Wharf", "Gangway", "Wheel House/ Passenger Saloon", "Tire Fenders"], correct: "Wheel House/ Passenger Saloon" },
        { q: "How frequent the shipboard drills need to be conducted?", a: ["Weekly", "Every 2 Weeks", "Monthly", "As per Drill Matrix"], correct: "As per Drill Matrix" },
        { q: "Which of the followings need to be reported to DPA?", a: ["Incident/Accident", "Near Miss", "Emergency", "All the Above"], correct: "All the Above" },
        { q: "Any Near Miss/Incident/ Accident must be reported to DPA within?", a: ["1 hour", "2 hours", "3 hours", "24 hours or immediately if practicable."], correct: "24 hours or immediately if practicable." },
        { q: "Which is NOT True about Company's SMS Section 4?", a: ["Role & Responsibility", "Master overriding Authority", "Forms and Checklist", "Emergency Preparedness"], correct: "Master overriding Authority" },
        { q: "Which is NOT True about Company's SMS Section 2?", a: ["Chief Officer Roles", "Master Roles", "Procedures for Shipboard Ops", "Incident Notification"], correct: "Chief Officer Roles and Responsibilities" },
        { q: "Who is the Safety Officer Onboard?", a: ["Master", "Chief Officer", "Chief Engineer", "Able Body"], correct: "Chief Officer" },
        { q: "On the vessel, crew only allowed to smoke at?", a: ["Bridge Wing", "Toilet", "Designated Smoking Area outside 500m Zone", "All Above"], correct: "Designated Smoking Area when outside of 500m Zone." },
        { q: "What happens to those violating IOGP Life Saving Rules?", a: ["ACT", "Warning", "Consequence management/termination", "Small Fine"], correct: "Consequence management or possible termination for serious cases." },
        { q: "What is HEMP?", a: ["Hazard and Effect Management Process", "HSSE and Medical Procedure", "Hazard Environment Procedure", "HSSE Management Procedure"], correct: "Hazard and Effect Management Process" },
        { q: "What is the objective of HEMP?", a: ["Identify hazards to ALARP", "Assess risks and control measures", "Propose recovery measures", "All of the above"], correct: "All of the above" },
        { q: "What is the first step in the HEMP process?", a: ["Identify the hazards", "Decide who might be harmed", "Evaluate risks", "Record findings"], correct: "Identify the hazards" },
        { q: "What is the correct Hierarchy of Control (Most to Least effective)?", a: ["Engineering -> PPE -> Admin", "PPE -> Admin -> Elimination", "Elimination -> Substitution -> Engineering -> Admin -> PPE", "Elimination -> PPE -> Engineering"], correct: "Elimination -> Substitution -> Engineering -> Administrative Controls -> PPE" },
        { q: "Which Waste Recycling Bin color is incorrect?", a: ["Blue: Paper", "Red: Plastic", "Green: Food Waste", "Yellow: General Waste"], correct: "Yellow: General Waste" },
        { q: "The following are prohibited items onboard EXCEPT:", a: ["Tattoo Machine", "Food", "Fishing equipment", "Weapons"], correct: "Food" },
        { q: "The following are prohibited items onboard vessel EXCEPT:", a: ["Gambling Items", "Alcohol", "Drugs", "Hand Phone"], correct: "Hand Phone" },
        { q: "What is the Company's prescribed BAC limit?", a: ["0.00%", "0.01%", "0.02%", "0.03%"], correct: "0.00%" },
        { q: "The Company will conduct Drug & Alcohol testing EXCEPT:", a: ["During Operation", "Post-Incident", "Random", "Pre-employment"], correct: "During Operation" },
        { q: "All of these are PPE except:", a: ["Safety Gloves", "FR Coverall", "Sunglasses", "Safety Helmet"], correct: "Sunglasses" },
        { q: "When can we still use a fire-retardant coverall?", a: ["Contaminated", "Damaged hardware", "Burn holes", "None of the above"], correct: "None of the above" },
        { q: "When can we still use safety gloves?", a: ["Contaminated", "Rips/tears", "Shrinkage", "None of the above"], correct: "None of the above" },
        { q: "How many rules does the IOGP Life-saving rules have?", a: ["9", "12", "15", "18"], correct: "9" },
        { q: "How many rules does the Petronas ZeTo rules have?", a: ["9", "10", "12", "15"], correct: "10" },
        { q: "All of these are IOGP Life-Saving Rules Except:", a: ["Hot Work", "Line of Fire", "Working at Height", "Walking"], correct: "Walking" },
        { q: "Which is NOT an IOGP Life-Saving Rule regarding Work Authorization?", a: ["Confirmed permit", "Authorized to perform", "Position to avoid vehicles", "Hazards are controlled"], correct: "I position myself to avoid vehicles" },
        { q: "All of these are IOGP Life-Saving Rules Except:", a: ["Bypassing Safety Controls", "Jumping", "Confined Space", "Driving"], correct: "Jumping" },
        { q: "Which is NOT a step before you start work?", a: ["Start work", "Plan", "Check Equipment", "Final Check"], correct: "Start work" },
        { q: "What is Step 7 of the Safe Work Process?", a: ["Communication tool", "Tool for work", "Structured safety conversation tool", "Briefing tool"], correct: "A tool to enable structured safety conversation and learning before, during and after work." },
        { q: "Which are correct for Master's roles & responsibilities?", a: ["i & iv", "i, ii & iii", "ii, iii & iv", "All of the above"], correct: "i, ii & iii" },
        { q: "Which are correct for Chief Officer's roles?", a: ["i, ii & iv", "i, iii, iv & v", "i, ii, iv & v", "All of the above"], correct: "i, ii, iv & v" },
        { q: "Which are correct for Chief Engineer's roles?", a: ["i, ii & iii", "i, iii & iv", "i & ii", "All of the above"], correct: "i, ii & iii" },
        { q: "What are Crew members' roles onboard?", a: ["i, ii & iii", "i & ii", "i, ii & iv", "All of the above"], correct: "All of the above" },
        { q: "Which is NOT a marine hazard/risk?", a: ["Weather", "Fire", "Land Excavation", "MOB"], correct: "Land Excavation Hazard" },
        { q: "Which is true about H2S?", a: ["Hydrogen Sulfide / Sour Gas", "Poisonous/Paralyze breathing", "1-20 ppm causes nausea", "All the Above"], correct: "All the Above." },
        { q: "Which physical property of H2S is wrong?", a: ["Toxic gas", "Flammable", "Rotten egg smell at high concentration", "Heavier than air"], correct: "Rotten egg smell at high concentration" },
        { q: "Where should you escape during an H2S leak?", a: ["Lower ground/crosswind", "Higher ground/crosswind & upwind", "Higher ground/downwind", "Lower ground/downwind"], correct: "Escape to a location with higher ground level and go crosswind & upwind direction." },
        { q: "Where can H2S possibly be found in high concentration?", a: ["i, iii & iv", "i & iv", "ii, iii & iv", "All of the above"], correct: "All of the above" },
        { q: "How to detect H2S in the correct way?", a: ["Personal gas detector", "Smell", "Portable gas detector for concentration", "Helmet sensor"], correct: "Use a portable gas detector to determine the concentration of H2S in an area." },
        { q: "Which policy states the right of an individual to stop work?", a: ["Safe Navigational", "Stop Work Policy", "Security", "Human Rights"], correct: "Stop Work Policy" },
        { q: "Which is NOT applicable to Stop Work Policy?", a: ["Master/Crew familiarity", "No harm goal", "Ensure all go home safely", "Stop unsafe act"], correct: "The master and all crews must be familiar with their roles and responsibilities" },
        { q: "Neopetro ensures physical fitness through which medical policy item?", a: ["Work Life Balance", "Pre-employment Assessment/FTW", "Annual blood test"], correct: "Pre-employment Medical Assessment/FTW" },
        { q: "Neopetro's Medical Policy consists of:", a: ["Outpatient benefits", "AME recognition", "Pre-employment assessment", "All of the above"], correct: "All of the above" },
        { q: "Why is Drug & Alcohol Policy viewed seriously?", a: ["Human error", "Threat to safety/security", "Subject to termination", "All of the above"], correct: "All of the above" },
        { q: "Which is NOT applicable to the Drug & Alcohol Policy?", a: ["Right to search", "Not condone sale", "Employees allowed to consume at work", "Permit designated positions"], correct: "Employees are allowed to consume or possess any alcohol in any work locations" },
        { q: "What is the main purpose of No Smoking Policy?", a: ["Prevent fire onboard ships", "Prevent fire onboard ships or office", "Health"], correct: "Committed to preventing fire incident onboard our ships or office premises" },
        { q: "Where are Non-Designated Smoking Areas?", a: ["Cabin, Mess, Galley, Wheelhouse, Paint Store", "Main Deck"], correct: "Cabin, Mess Rooms, Galley, Washrooms, Provision Stores, Wheelhouse, Cold/Freezer Room, Paint Store, Machinery Areas" },
        { q: "Which is NOT an element of Waste Management Policy?", a: ["Protect environment", "Not necessarily comply with MARPOL", "Prevent incidents", "Promote awareness"], correct: "Not necessarily comply with the MARPOL requirements" },
        { q: "Why is Anti-Bribery and Corruption Policy established?", a: ["Honest/Ethical manner", "Zero-Tolerance", "Act professionally", "All of the above"], correct: "All of the above" },
        { q: "Which policy states we conduct business in an honest/ethical manner?", a: ["Human Rights", "Drug/Alcohol", "Anti-Bribery and Corruption", "Waste Management"], correct: "Anti-Bribery and Corruption Policy" },
        { q: "Which policy protects rights/welfare of stakeholders?", a: ["Human Rights Policy", "Main HSSE", "Medical", "Safe Navigation"], correct: "Human Rights Policy" },
        { q: "What is the purpose of Cyber Security Policy?", a: ["Defend system", "Defend ship from piracy", "Save battery"], correct: "Recognizes the importance of Cyber Security and committed to defend the Company's system" },
        { q: "Which is NOT an obligation under Cyber Security Policy?", a: ["Protect Data", "Protect Devices", "Secure Transfer", "Change email password every month"], correct: "Change email password every month" },
        { q: "Where is the MUSTER STATION located?", a: ["Bridegroom", "Main Deck on vessel", "Engine Room", "Galley"], correct: "Main Deck on vessel v" },
        { q: "Give 3 examples of Emergency Situation:", a: ["Lifting/Mooring", "MOB/Collision/Grounding", "TV breakdown"], correct: "Man-overboard/collision/grounding" },
        { q: "How frequent shipboard drills need to be conducted?", a: ["Weekly", "Every 2 Weeks", "Monthly", "As per Drill Matrix"], correct: "As per drill matrix" },
        { q: "Neopetro has how many policies?", a: ["9", "10", "11", "12"], correct: "11" },
        { q: "Paracetamol is part of First Aid Kit item?", a: ["True", "False"], correct: "False" },
        { q: "Medical Chest is a requirement by the company?", a: ["True", "False"], correct: "False" },
        { q: "All crew shall complete Health declaration form when?", a: ["Within a week", "Health monitoring", "Prior mobilization", "Monthly"], correct: "Prior mobilization" }
    ];

    let currentCourse = "", selectedQuestions = [], currentQIndex = 0, userAnswers = [], timer, timeLeft = 60, finalScore = 0;

    function hideAll() { 
        ['briefing-section', 'crew-info-section', 'category-selection', 'sub-selection', 'pdf-viewer', 'exam-section', 'result-section'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.classList.add('hidden');
        });
    }

    function showCrewInfo() { 
        hideAll(); 
        document.getElementById('crew-info-section').classList.remove('hidden'); 
        document.getElementById('current_date').value = new Date().toLocaleDateString('en-GB'); 
    }

    function showCategorySelection() { 
        hideAll(); 
        document.getElementById('category-selection').classList.remove('hidden'); 
    }

    function validateAndProceed() { 
        const name = document.getElementById('crew_name').value;
        const pos = document.getElementById('crew_position').value;
        const vsl = document.getElementById('vessel_name').value;
        const dat = document.getElementById('sign_on_date').value;
        if(!name || !pos || !vsl || !dat) return alert("Please fill in all information fields."); 
        showCategorySelection(); 
    }
    
    function showSubSelection(cat) { 
        hideAll(); 
        const grid = document.getElementById('sub-grid'); 
        document.getElementById('selected-main-category').innerText = cat; 
        grid.innerHTML = '';
        trainingData[cat].forEach(sub => { 
            let b = document.createElement('button'); 
            b.className = 'btn'; 
            b.innerText = sub; 
            b.onclick = () => openPDF(sub); 
            grid.appendChild(b); 
        });
        document.getElementById('sub-selection').classList.remove('hidden');
    }

    function openPDF(sub) { 
        hideAll(); 
        currentCourse = sub; 
        document.getElementById('current-course-title').innerText = sub;
        document.getElementById('pdf-box').innerHTML = `<iframe src="${encodeURIComponent(pdfFiles[sub])}"></iframe>`;
        document.getElementById('pdf-viewer').classList.remove('hidden');
    }

    function toggleExamBtn() { 
        document.getElementById('exam-start-btn').disabled = !document.getElementById('read-confirm').checked; 
    }

    function shuffleArray(array) {
        let arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function startExam() {
        hideAll(); 
        document.getElementById('exam-section').classList.remove('hidden');
        selectedQuestions = shuffleArray(masterQuestionBank).slice(0, 25).map(q => {
            return { ...q, options: shuffleArray(q.a) };
        });
        currentQIndex = 0; 
        userAnswers = []; 
        loadQuestion();
    }

    function loadQuestion() {
        clearInterval(timer); 
        timeLeft = 60; 
        document.getElementById('timer-count').innerText = timeLeft;
        document.getElementById('exam-progress').style.width = (currentQIndex / 25 * 100) + "%";
        
        const qData = selectedQuestions[currentQIndex];
        document.getElementById('question-area').innerHTML = `
            <div class="question-card">
                <h3>Question ${currentQIndex+1} of 25</h3>
                <p style="font-size:1.1em; font-weight:500;">${qData.q}</p>
                <div class="options">
                    ${qData.options.map((opt) => `
                        <label><input type="radio" name="q" value="${opt}"> ${opt}</label>
                    `).join('')}
                </div>
            </div>`;
        timer = setInterval(() => { 
            timeLeft--; 
            document.getElementById('timer-count').innerText = timeLeft; 
            if(timeLeft <= 0) nextQuestion(); 
        }, 1000);
    }

    function nextQuestion() {
        const sel = document.querySelector('input[name="q"]:checked');
        userAnswers[currentQIndex] = sel ? sel.value : null;
        if(++currentQIndex < 25) loadQuestion(); else showResults();
    }

    function showResults() {
        clearInterval(timer); 
        hideAll(); 
        document.getElementById('result-section').classList.remove('hidden');
        finalScore = 0; 
        userAnswers.forEach((ans, idx) => { if (ans === selectedQuestions[idx].correct) finalScore++; });
        const pct = (finalScore/25*100).toFixed(0);
        const passed = finalScore >= 20;
        
        document.getElementById('result-content').innerHTML = `
            <div style="margin-bottom:20px;">
                <p>Course: <strong>${currentCourse}</strong></p>
                <h3>Final Score: ${finalScore} / 25 (${pct}%)</h3>
            </div>
            ${passed ? '<p class="pass">✅ ASSESSMENT PASSED</p>' : '<p class="fail">❌ ASSESSMENT FAILED<br><span style="font-size:0.7em">Score 80% or higher to pass.</span></p>'}`;
        
        const acts = document.getElementById('result-actions'); 
        acts.innerHTML = '';
        if(passed) { 
            let b = document.createElement('button'); 
            b.className = 'btn btn-gold'; 
            b.innerText = "Download Certificate"; 
            b.onclick = printCert; 
            acts.appendChild(b); 
        }
        let r = document.createElement('button'); 
        r.className = 'btn'; 
        r.innerText = "Restart Training"; 
        r.onclick = () => location.reload(); 
        acts.appendChild(r);
    }

    function printCert() {
        document.getElementById('cert-user-name').innerText = document.getElementById('crew_name').value.toUpperCase();
        document.getElementById('cert-course-name').innerText = currentCourse;
        document.getElementById('cert-score').innerText = (finalScore/25*100).toFixed(0);
        document.getElementById('cert-date').innerText = document.getElementById('current_date').value;
        window.print();
    }
</script>
</body>
</html>
